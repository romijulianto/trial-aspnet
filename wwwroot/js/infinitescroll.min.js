/*!
 * Infinite Scroll for ASP.NET Maker v2023.1.0
 * Copyright (c) e.World Technology Limited. All rights reserved.
 */
!function(t,e){"use strict";var i=t=>t&&"object"==typeof t&&"default"in t?t:{default:t},a=i(t),r=i(e);function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t){var e=function(t,e){if("object"!==s(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!==s(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===s(e)?e:String(e)}function o(t,e,i){return(e=l(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}let n=function(){function t(e,i){var r,s,l;this.container=document.getElementById(e),this.table=this.getTable(),this.table&&this.table.rows&&this.container&&this.container.classList.contains("ew-grid-middle-panel")&&(this.options=i||{},this.pageCount=i.pageCount,null!=(r=this.options).rootMargin||(r.rootMargin=t.rootMargin),null!=(s=this.options).threshold||(s.threshold=t.threshold),null!=(l=this.options).overlayScrollbars||(l.overlayScrollbars=t.overlayScrollbars),this.$document=a.default(document),this.$container=a.default(this.container).addClass("table-responsive"),this.$grid=this.$container.closest(".ew-grid"),this.$panels=this.$grid.find(".ew-grid-lower-panel, .ew-grid-upper-panel").innerWidth("100%"),this.$form=this.$grid.closest(".ew-form:not(.ew-list-form)"),this.$detailPages=this.$grid.closest(".ew-detail-pages").addClass("d-block"),this.$tabPane=this.$grid.closest(".tab-pane"),this.$tab=this.$detailPages.find("a[data-bs-toggle=tab][href='#"+this.$tabPane.attr("id")+"']"),this.$collapse=this.$grid.closest(".collapse"),this.isActive=this.$tab.hasClass("show")||this.$collapse.hasClass("show")||!this.$detailPages[0],this.isDetail=!!this.$form[0],this.isDetail&&!this.isActive?(this.$tab.on("shown.bs.tab",this.init.bind(this)),this.$collapse.on("shown.bs.collapse",this.init.bind(this))):this.init())}var e=t.prototype;return e.getTable=function(){var t;return null==(t=this.container)?void 0:t.querySelector("table.ew-table.ew-infinite-scroll-table")},e.getWidth=function(){return r.default.isMobile()?"100%":""},e.getUrl=function(t){return r.default.currentPage()+"?"+r.default.TABLE_PAGE_NUMBER+"="+t},e.getParams=function(){return new URLSearchParams([[r.default.TOKEN_NAME_KEY,r.default.TOKEN_NAME],[r.default.ANTIFORGERY_TOKEN_KEY,r.default.ANTIFORGERY_TOKEN],[r.default.PAGE_LAYOUT,"false"],["infinitescroll","1"]])},e.setCurrentPage=function(t){this.currentPage=t,history.replaceState(null,"",this.getUrl(t))},e.observe=function(e){this.observer||(this.observer=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){let i=e.target;if(i.matches("tr")){let t=i.closest("tbody[data-page]");t.nextElementSibling||t.closest(".ew-grid.ew-loading")||this.load(parseInt(t.dataset.page,10))}else i.matches("tbody[data-page]")&&e.intersectionRatio>(this.options.threshold[1]||t.threshold[1])&&this.setCurrentPage(parseInt(i.dataset.page,10))}}))}),{root:this.container,rootMargin:this.options.rootMargin,threshold:this.options.threshold})),e&&this.observer.observe(e)},e.observeTableBody=function(e){this.observe(e);let i=Math.max(t.countToLast,1)||1;for(let t=1;t<=i;t++)this.observe(e.querySelector(":scope > tr:nth-last-child("+t+")"))},e.load=function(e){if(e>=this.pageCount)return;if(this.$grid.find("[data-rowtype="+r.default.ROWTYPE_ADD+"], [data-rowtype="+r.default.ROWTYPE_EDIT+"]")[0])return;let i=a.default(r.default.overlayTemplate());this.$grid.addClass("ew-loading").append(i),fetch(this.getUrl(++e),{method:"POST",body:this.getParams()}).then((async e=>{let i=a.default("<div>"+await e.text()+"</div>"),s=i.find(".list")[0],l=i.find(".ew-infinite-scroll-table > tbody[data-page]")[0];if(l){t.replaceSelectors.forEach((t=>a.default(t).html(i.find(t).html()))),t.appendSelectors.forEach((t=>a.default(t).append(i.find(t).html())));let e=a.default.Event({type:"load.ew",target:s});this.table.appendChild(l),r.default.initPage(e),this.$document.trigger(e),Array.from(this.table.rows).forEach(((t,e)=>t.dataset.rowindex=e)),this.observeTableBody(l)}})).finally((()=>this.$grid.removeClass("ew-loading").find(i).remove()))},e.setupTable=function(){if(this.table=this.getTable(),r.default.setupTable(this.table),this.table.rows&&this.container.clientHeight>this.table.offsetHeight){let t=a.default(this.table.rows).filter(":not(.ew-template)"),e=t.filter("[data-rowindex=1]").length||t.filter("[data-rowindex=0]").length||1;t.slice(-1*e).find("td.ew-table-last-row").removeClass("ew-table-last-row").addClass("ew-table-border-bottom")}this.options.overlayScrollbars&&loadjs.ready("scrollbars",(()=>{var t;null==(t=OverlayScrollbars(this.container))||t.destroy(),OverlayScrollbars(this.container,r.default.overlayScrollbarsOptions)}));let t=this.table.querySelector("tbody[data-page]");!t||this.observeTableBody(t)},e.init=function(){if(this.$container.data("InfiniteScroll"))return;a.default(document).ajaxSend((function(t,e,i){let s=i.data;if(a.default.isString(s)&&s.startsWith("[{")&&s.endsWith("}]")){let t=r.default.parseJson(s);Array.isArray(t)&&(i.data=JSON.stringify(t.map((t=>({...t,infinitescroll:1})))))}else i.data=r.default.mergeSearchParams(s,{infinitescroll:1})})),a.default(document).on("fetch",(function(t,e){null!=e.init||(e.init={}),!e.init.method||r.default.sameText(e.init.method,"GET")?e.url=r.default.setSearchParams(e.url,{infinitescroll:1}):e.init.body=r.default.mergeSearchParams(e.init.body,{infinitescroll:1})}));let t=this.getWidth();this.isDetail&&t&&this.$form.addClass("w-100"),(this.isDetail||r.default.isMobile())&&this.$grid.addClass("d-block"),this.setupTable(),this.$document.on("refresh.ew",(t=>{let e=t.target;if(this.$grid[0]==e){var i;(null!=(i=e.querySelector(".os-viewport"))?i:e.querySelector(".ew-grid-middle-panel")).scrollTop=0,this.setupTable()}})),this.$container.data("InfiniteScroll",this)},t}();o(n,"countToLast",1),o(n,"rootMargin","0px"),o(n,"threshold",[0,.25]),o(n,"overlayScrollbars",!1),o(n,"replaceSelectors",[".ew-infinite-scroll-grid .ew-grid-upper-panel .ew-pager-end",".ew-infinite-scroll-table thead",".ew-infinite-scroll-grid .ew-grid-lower-panel .ew-pager-end"]),o(n,"appendSelectors",[".ew-debug .card-body"]),Object.assign(r.default,{InfiniteScroll:n})}(jQuery,ew);
//# sourceMappingURL=infinitescroll.min.js.map