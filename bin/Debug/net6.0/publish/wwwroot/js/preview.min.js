/*!
 * Detail Preview for ASP.NET Maker v2023.1.0
 * Copyright (c) e.World Technology Limited. All rights reserved.
 */
!function(e,t){"use strict";var a=e=>e&&"object"==typeof e&&"default"in e?e:{default:e},d=a(e),l=a(t);l.default.PREVIEW=!0,l.default.PREVIEW_TEMPLATE='<div class="ew-nav">\x3c!-- .ew-nav --\x3e\n    <ul class="nav nav-tabs" role="tablist"></ul>\n    <div class="tab-content">\x3c!-- .tab-content --\x3e\n        <div class="tab-pane fade" role="tabpanel"></div>\n    </div>\x3c!-- /.tab-content --\x3e\n</div>\x3c!-- /.ew-nav --\x3e',l.default.PREVIEW_LOADING_HTML=l.default.spinnerTemplate(),l.default.PREVIEW_MODAL_HTML='<div id="ew-preview-dialog" class="'+l.default.PREVIEW_MODAL_CLASS+'" role="dialog" aria-hidden="true"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">'+l.default.language.phrase("CloseBtn")+"</button></div></div></div></div>",l.default.PREVIEW_MODAL_OPTIONS={},l.default.PREVIEW_MODAL_DIALOG=null,l.default.PREVIEW_OFFCANVAS_HTML='<div id="ew-preview-offcanvas" class="offcanvas offcanvas-'+l.default.PREVIEW_OFFCANVAS_PLACEMENT+'" data-bs-scroll="true" tabindex="-1" aria-labelledby="ew-preview-offcanvas-label"><div class="offcanvas-header"><h5 id="ew-preview-offcanvas-label">'+l.default.language.phrase("Details")+'</h5><button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"></div></div>',l.default.PREVIEW_OFFCANVAS_OPTIONS={},l.default.PREVIEW_OFFCANVAS_SIDEBAR=null;const n=d.default(document);let o=e=>{let t=d.default(e.currentTarget).closest("tr"),a=t.is("tr[data-rowindex]")?t:t.closest("tr[data-rowindex]"),n=a.find("[class$=_preview] .ew-preview"),o=a.closest("table");if(a[0]&&n[0]){if("true"===a.attr("aria-expanded")){let e=function(e){let t,a=d.default(e),n=a.closest("tbody");l.default.PREVIEW_SINGLE_ROW&&(n.find("tr.ew-table-preview-row").remove(),n.find("tr[aria-expanded]").not(e).attr("aria-expanded","false"));let o=Array.from(e.cells).reduce(((e,t)=>e+t.colSpan),0),s=a.nextAll("tr[data-rowindex!="+a.data("rowindex")+"]").first();return s.hasClass("ew-table-preview-row")?s[0]:((t=n[0].insertRow(s[0]?s[0].sectionRowIndex:-1))&&(d.default(t).addClass("ew-table-preview-row expandable-body"),d.default(t.insertCell(0)).addClass("ew-table-last-col").prop("colSpan",o)),t)}(a[0]),t=d.default(e.cells[0]),o="target"+l.default.random();t.empty(),t.append(l.default.PREVIEW_TEMPLATE),t.children().slideUp(0),t.find(".nav-tabs, .nav-pills").append(n.find(".nav-item").clone(!0)),t.find(".tab-pane").attr("id",o),t.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+o,"aria-controls":o}).first().tab("show"),t.children().slideDown(500)}l.default.setupTable(o[0],!0)}},s=function(e,t){var a;if(bootstrap.Popover.getInstance(t))return;let n=d.default(t.closest(".ew-list-option-body, .ew-multi-column-list-option-table, .ew-multi-column-list-option-card"));if(null==(a=bootstrap.Tooltip.getInstance(t))||a.dispose(),!(t=t.closest(l.default.PREVIEW_SELECTOR)))return;t.classList.contains("ew-preview-btn")||t.classList.add("ew-preview-btn");let o=new bootstrap.Popover(t,{...l.default.popoverOptions,delay:l.default.PREVIEW_POPOVER_DELAY,placement:l.default.PREVIEW_POPOVER_PLACEMENT,container:document.getElementById("ew-tooltip"),content:l.default.PREVIEW_LOADING_HTML,customClass:"ew-preview-popover",trigger:"click"==l.default.PREVIEW_POPOVER_TRIGGER?"click":"manual"});t.addEventListener("show.bs.popover",(()=>{var e;return null==(e=c())?void 0:e.hide()})),t.addEventListener("shown.bs.popover",(()=>{let e="target"+l.default.random(),t=d.default(o._getTipElement());t.find(".popover-body").empty().html(l.default.PREVIEW_TEMPLATE),t.find(".nav-tabs, .nav-pills").append(n.find(".nav-item").clone(!0)),t.find(".tab-pane").attr("id",e),t.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+e,"aria-controls":e}).first().tab("show")})),"click"!=l.default.PREVIEW_POPOVER_TRIGGER&&t.addEventListener(l.default.PREVIEW_POPOVER_TRIGGER,(function(){var e;this.getAttribute("aria-describedby")||null==(e=bootstrap.Popover.getInstance(this))||e.show()}))},i=function(e,t){var a;null==(a=bootstrap.Tooltip.getInstance(t))||a.dispose(),(t=t.closest(l.default.PREVIEW_SELECTOR))&&(t.classList.contains("ew-preview-btn")||t.classList.add("ew-preview-btn"),t.addEventListener("click",(()=>{l.default.PREVIEW_MODAL_DIALOG.attr("data-parent-id",this.closest("[id^=el]").id).modal("hide"),l.default.PREVIEW_MODAL_DIALOG.modal("show")})))},r=function(e,t){var a;null==(a=bootstrap.Tooltip.getInstance(t))||a.dispose(),(t=t.closest(l.default.PREVIEW_SELECTOR))&&(t.classList.contains("ew-preview-btn")||t.classList.add("ew-preview-btn"),t.addEventListener("click",(()=>{l.default.PREVIEW_OFFCANVAS_SIDEBAR.attr("data-parent-id",this.closest("[id^=el]").id).offcanvas("hide"),l.default.PREVIEW_OFFCANVAS_SIDEBAR.offcanvas("show")})))},f=function(e){let t=e.currentTarget,a=t.dataset.bsTarget||t.closest(".tab-pane");if(!a)return;let o=d.default(t),s=d.default(a),{url:i,page:r,table:u,sort:p,sortOrder:v,sortType:b}=t.dataset,E=new URLSearchParams,w=s.data(u)||{};i?(w.url=i,p=w.sort,v=w.sortOrder,r?(o.tooltip("hide"),w.page=r,s.data(u,w).find(".card.ew-grid").append(l.default.overlayTemplate())):(r=w.page||1,s.data(u,w).empty().html(l.default.PREVIEW_LOADING_HTML))):p&&(i=w.url,p!==w.sort||v!==w.sortOrder?w.page=r=1:r=w.page,w.sort=p,w.sortOrder=v,s.data(u,w).find(".card.ew-grid").append(l.default.overlayTemplate())),d.default.isNumber(r)&&E.set(l.default.TABLE_PAGE_NUMBER,r),p&&(E.set(l.default.TABLE_SORT,p),["ASC","DESC","NO"].includes(v)&&E.set("sortorder",v),e.shiftKey&&!e.ctrlKey?E.set("cmd","resetsort"):2==b&&e.ctrlKey&&E.set("ctrl","1")),l.default.fetch(i+"&"+E.toString()).then((async e=>{var t;if(null!=(t=e.headers.get("Content-Type"))&&t.includes("json")){let t=await e.json(),a=l.default.getError(t);if(a)return void l.default.alert(a)}else{let t=await e.text();s.empty().html(t);let l=".ew-detail-btn-group[data-table='"+u+"'][data-url='"+i+"']",r=s.closest(".ew-nav").find(l);if(r[0]||(r=d.default("body").children(l)),r.is("div"))s.append(r.removeClass("d-none"));else if(r.is("ul")){let e=o.closest(".nav-item").addClass("dropdown"),t=e.find(".dropdown-toggle").addClass("active").removeClass("d-none");t[0]||(t=o.clone(),t.addClass("dropdown-toggle").attr({"data-bs-toggle":"dropdown","data-bs-target":null,role:"button"}),e.prepend(t),o.on("hide.bs.tab",(()=>{e.removeClass("dropdown").find(o).removeClass("d-none active"),e.find(".dropdown-toggle").addClass("d-none").removeClass("active show")}))),o.addClass("d-none")}s.find(".ew-pager .btn:not(.disabled), .ew-table-header > th > div[data-sort]").data({target:a,table:u}).on("click",f),n.trigger(d.default.Event("preview.ew",{target:s[0],$tabpane:s}))}})).then((()=>{var e,t;null==(e=c())||e.update();let a=document.querySelector("#ew-preview-dialog");null!=a&&a.classList.contains("show")&&(null==(t=bootstrap.Modal.getInstance(a))||t.handleUpdate())}))},u=function(e){d.default(e.currentTarget.dataset.bsTarget).find(".dropdown-toggle[id]").dropdown("dispose");let t=e.currentTarget.closest(".popover, .modal, .nav");t&&d.default(t).find(".dropdown-toggle").dropdown("hide")},c=()=>{let e=document.querySelector(".ew-preview-popover.show");if(!e)return null;let t=document.querySelector(".ew-preview-btn[aria-describedby='"+e.id+"']");return t?bootstrap.Popover.getInstance(t):null};Object.assign(l.default,{showPreviewRow:o,detailPopover:s,detailModal:i,detailOffcanvas:r,showTab:f,hideTab:u,getActivePopover:c}),loadjs.ready("wrapper",(function(){document.addEventListener("click",(e=>{var t;e.target.closest(".ew-preview-popover")||null==(t=c())||t.hide()})),document.getElementById("ew-preview-dialog")||d.default("body").append(l.default.PREVIEW_MODAL_HTML),l.default.PREVIEW_MODAL_DIALOG=d.default("#ew-preview-dialog").modal(l.default.PREVIEW_MODAL_OPTIONS),d.default("#ew-preview-dialog").on("show.bs.modal",(function(){d.default(this).find(".modal-body").empty().html(l.default.PREVIEW_TEMPLATE)})).on("shown.bs.modal",(function(e){let t=d.default(this),a="target"+l.default.random();t.find(".nav-tabs, .nav-pills").append(d.default("#"+this.dataset.parentId).find(".nav-item").clone(!0)),t.find(".tab-pane").attr("id",a),t.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+a,"aria-controls":a}).first().tab("show")})),document.getElementById("ew-preview-offcanvas")||d.default("body").append(l.default.PREVIEW_OFFCANVAS_HTML),l.default.PREVIEW_OFFCANVAS_SIDEBAR=d.default("#ew-preview-offcanvas").offcanvas(l.default.PREVIEW_OFFCANVAS_OPTIONS),d.default("#ew-preview-offcanvas").on("show.bs.offcanvas",(function(){d.default(this).find(".offcanvas-body").empty().html(l.default.PREVIEW_TEMPLATE)})).on("shown.bs.offcanvas",(function(){let e=d.default(this),t="target"+l.default.random();e.find(".nav-tabs, .nav-pills").append(d.default("#"+this.dataset.parentId).find(".nav-item").clone(!0)),e.find(".tab-pane").attr("id",t),e.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+t,"aria-controls":t}).first().tab("show")}))}));let p=function(e){var t;let a=null!=(t=null==e?void 0:e.target)?t:document,n=d.default(a);l.default.PREVIEW_POPOVER?n.find(".ew-preview-btn").each(s):l.default.PREVIEW_MODAL?n.find(".ew-preview-btn").each(i):l.default.PREVIEW_OFFCANVAS?n.find(".ew-preview-btn").each(r):l.default.PREVIEW_ROW&&function(e){var t;let a=null!=(t=null==e?void 0:e.target)?t:document;d.default(a).find("tr[data-rowindex][data-widget='expandable-table']").on("expanded.lte.expandableTable",o)}(e),function(e){var t;let a=null!=(t=null==e?void 0:e.target)?t:document;d.default(a).find(".ew-preview [data-bs-toggle='tab']").on("show.bs.tab",f).on("hide.bs.tab",u)}(e)};d.default(p),d.default(".ew-multi-column-grid").on("load.ew",p),n.on("refresh.ew",p),n.on("preview.ew",(function(e){l.default.lazyLoad(e),l.default.initPanels(e.$tabpane[0]),e.$tabpane.find("table.ew-table").each(l.default.setupTable),l.default.initTooltips(e),l.default.initLightboxes(e),l.default.initIcons(e)}))}(jQuery,ew);
//# sourceMappingURL=preview.min.js.map